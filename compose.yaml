services:
  ollama:
    image: ollama-offline:latest
    container_name: ollama
    volumes:
      - ollama_models:/root/.ollama
    networks: [rag-net]

  rag-app:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: rag-app
    depends_on: [ollama]

    # ------------ mounts ------------
    volumes:
      # 1Ô∏è‚É£  Chroma runtime DB  ‚ûú writable
      - chroma_data:/app/data/chroma
      - ./data/persist:/app/data/persist:ro
      # üëá NEW ‚Äì offline Mini-LM cross-encoder
      - ./offline_llm_models/cross_encoder:/app/models/cross_encoder:ro

    # --------------------------------

    ports:
      - "8000:8000"

    environment:
      - OLLAMA_BASE_URL=http://ollama:11434
      - OLLAMA_HOST=http://ollama:11434
      - LANGCHAIN_ENDPOINT=disabled
      - CHROMA_TELEMETRY=FALSE # disable telemetry

    networks: [rag-net]

volumes:
  chroma_data:
  # chroma_persist:     # uncomment if you added the volume above
  ollama_models:

networks:
  rag-net:
